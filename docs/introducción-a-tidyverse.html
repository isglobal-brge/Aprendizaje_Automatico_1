<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Introducción a Tidyverse | Aprendizaje Automático 1</title>
  <meta name="description" content="2 Introducción a Tidyverse | Aprendizaje Automático 1" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Introducción a Tidyverse | Aprendizaje Automático 1" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Introducción a Tidyverse | Aprendizaje Automático 1" />
  
  
  

<meta name="author" content="Juan R González" />


<meta name="date" content="2020-09-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="regresión-lineal.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Aprendizaje Automático 1</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introducción</a></li>
<li class="chapter" data-level="2" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html"><i class="fa fa-check"></i><b>2</b> Introducción a Tidyverse</a>
<ul>
<li class="chapter" data-level="2.1" data-path="index.html"><a href="index.html#introducción"><i class="fa fa-check"></i><b>2.1</b> Introducción</a></li>
<li class="chapter" data-level="2.2" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#instalación"><i class="fa fa-check"></i><b>2.2</b> Instalación</a></li>
<li class="chapter" data-level="2.3" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#librerías-básicas"><i class="fa fa-check"></i><b>2.3</b> Librerías básicas</a></li>
<li class="chapter" data-level="2.4" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#manejo-de-datos"><i class="fa fa-check"></i><b>2.4</b> Manejo de datos</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#tibbles"><i class="fa fa-check"></i><b>2.4.1</b> Tibbles</a></li>
<li class="chapter" data-level="2.4.2" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#importar-datos"><i class="fa fa-check"></i><b>2.4.2</b> Importar datos</a></li>
<li class="chapter" data-level="2.4.3" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#transformación-de-datos"><i class="fa fa-check"></i><b>2.4.3</b> Transformación de datos</a></li>
<li class="chapter" data-level="2.4.4" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#filtrar-filas"><i class="fa fa-check"></i><b>2.4.4</b> Filtrar filas</a></li>
<li class="chapter" data-level="2.4.5" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#filtrado-lógico"><i class="fa fa-check"></i><b>2.4.5</b> Filtrado lógico</a></li>
<li class="chapter" data-level="2.4.6" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#ordenar-filas"><i class="fa fa-check"></i><b>2.4.6</b> Ordenar filas</a></li>
<li class="chapter" data-level="2.4.7" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#seleccionar-columnas-e.g.-variables"><i class="fa fa-check"></i><b>2.4.7</b> Seleccionar columnas (e.g. variables)</a></li>
<li class="chapter" data-level="2.4.8" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#añadir-nuevas-variables"><i class="fa fa-check"></i><b>2.4.8</b> Añadir nuevas variables</a></li>
<li class="chapter" data-level="2.4.9" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#grouped-summaries"><i class="fa fa-check"></i><b>2.4.9</b> Grouped summaries</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#uso-del-pipe"><i class="fa fa-check"></i><b>2.5</b> Uso del pipe <code>%&gt;%</code></a></li>
<li class="chapter" data-level="2.6" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#ejercicios-manejo-de-datos"><i class="fa fa-check"></i><b>2.6</b> Ejercicios (manejo de datos)</a></li>
<li class="chapter" data-level="2.7" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#visualización-de-datos"><i class="fa fa-check"></i><b>2.7</b> Visualización de datos</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#distribución-de-datos-categóricos"><i class="fa fa-check"></i><b>2.7.1</b> Distribución de datos categóricos</a></li>
<li class="chapter" data-level="2.7.2" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#distribución-de-datos-continuos"><i class="fa fa-check"></i><b>2.7.2</b> Distribución de datos continuos</a></li>
<li class="chapter" data-level="2.7.3" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#distribución-de-datos-continuos-según-una-variable-categórica"><i class="fa fa-check"></i><b>2.7.3</b> Distribución de datos continuos según una variable categórica</a></li>
<li class="chapter" data-level="2.7.4" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#dos-variables-categóricas"><i class="fa fa-check"></i><b>2.7.4</b> Dos variables categóricas</a></li>
<li class="chapter" data-level="2.7.5" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#dos-variables-continuas"><i class="fa fa-check"></i><b>2.7.5</b> Dos variables continuas</a></li>
<li class="chapter" data-level="2.7.6" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#facets"><i class="fa fa-check"></i><b>2.7.6</b> Facets</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#ejercicios-visualización-de-datos"><i class="fa fa-check"></i><b>2.8</b> Ejercicios (Visualización de datos)</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="regresión-lineal.html"><a href="regresión-lineal.html"><i class="fa fa-check"></i><b>3</b> Regresión lineal</a>
<ul>
<li class="chapter" data-level="3.1" data-path="regresión-lineal.html"><a href="regresión-lineal.html#preliminares"><i class="fa fa-check"></i><b>3.1</b> Preliminares</a></li>
<li class="chapter" data-level="3.2" data-path="regresión-lineal.html"><a href="regresión-lineal.html#conceptos-básicos"><i class="fa fa-check"></i><b>3.2</b> Conceptos básicos</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="regresión-lineal.html"><a href="regresión-lineal.html#modelo-lineal-simple"><i class="fa fa-check"></i><b>3.2.1</b> Modelo lineal simple</a></li>
<li class="chapter" data-level="3.2.2" data-path="regresión-lineal.html"><a href="regresión-lineal.html#regresión-lineal-multivariante"><i class="fa fa-check"></i><b>3.2.2</b> Regresión lineal multivariante</a></li>
<li class="chapter" data-level="3.2.3" data-path="regresión-lineal.html"><a href="regresión-lineal.html#incertidumbre"><i class="fa fa-check"></i><b>3.2.3</b> Incertidumbre</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="regresión-lineal.html"><a href="regresión-lineal.html#ajuste-de-un-modelo-lineal"><i class="fa fa-check"></i><b>3.3</b> Ajuste de un modelo lineal</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="regresión-lineal.html"><a href="regresión-lineal.html#residuos"><i class="fa fa-check"></i><b>3.3.1</b> Residuos</a></li>
<li class="chapter" data-level="3.3.2" data-path="regresión-lineal.html"><a href="regresión-lineal.html#coeficientes-de-interpretación"><i class="fa fa-check"></i><b>3.3.2</b> Coeficientes de interpretación</a></li>
<li class="chapter" data-level="3.3.3" data-path="regresión-lineal.html"><a href="regresión-lineal.html#interacciones"><i class="fa fa-check"></i><b>3.3.3</b> Interacciones</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="regresión-lineal.html"><a href="regresión-lineal.html#estimación-por-mínimos-cuadrados"><i class="fa fa-check"></i><b>3.4</b> Estimación por mínimos cuadrados</a></li>
<li class="chapter" data-level="3.5" data-path="regresión-lineal.html"><a href="regresión-lineal.html#medidas-adicionales-de-ajuste-del-modelo"><i class="fa fa-check"></i><b>3.5</b> Medidas adicionales de ajuste del modelo</a></li>
<li class="chapter" data-level="3.6" data-path="regresión-lineal.html"><a href="regresión-lineal.html#sesgo-variación-sobreajuste"><i class="fa fa-check"></i><b>3.6</b> Sesgo, variación, sobreajuste</a></li>
<li class="chapter" data-level="3.7" data-path="regresión-lineal.html"><a href="regresión-lineal.html#regresión-como-estimación-de-una-media-condicional"><i class="fa fa-check"></i><b>3.7</b> Regresión como estimación de una media condicional</a></li>
<li class="chapter" data-level="3.8" data-path="regresión-lineal.html"><a href="regresión-lineal.html#la-función-de-regresión"><i class="fa fa-check"></i><b>3.8</b> La función de regresión</a></li>
<li class="chapter" data-level="3.9" data-path="regresión-lineal.html"><a href="regresión-lineal.html#estimación-no-paramétrica-de-la-función-de-regresión-regresión-knn"><i class="fa fa-check"></i><b>3.9</b> Estimación no paramétrica de la función de regresión: regresión KNN</a></li>
<li class="chapter" data-level="3.10" data-path="regresión-lineal.html"><a href="regresión-lineal.html#estimación-paramétrica-de-la-función-de-regresión-regresión-lineal"><i class="fa fa-check"></i><b>3.10</b> Estimación paramétrica de la función de regresión: regresión lineal</a></li>
<li class="chapter" data-level="3.11" data-path="regresión-lineal.html"><a href="regresión-lineal.html#predicción-usando-el-objeto-del-modelo"><i class="fa fa-check"></i><b>3.11</b> Predicción usando el objeto del modelo</a></li>
<li class="chapter" data-level="3.12" data-path="regresión-lineal.html"><a href="regresión-lineal.html#inferencia-en-el-contexto-de-regresión"><i class="fa fa-check"></i><b>3.12</b> Inferencia en el contexto de regresión</a></li>
<li class="chapter" data-level="3.13" data-path="regresión-lineal.html"><a href="regresión-lineal.html#asunciones-de-un-modelo-de-regresión"><i class="fa fa-check"></i><b>3.13</b> Asunciones de un modelo de regresión</a></li>
<li class="chapter" data-level="3.14" data-path="regresión-lineal.html"><a href="regresión-lineal.html#ejemplos-adicionales-de-interpretación-de-modelos"><i class="fa fa-check"></i><b>3.14</b> Ejemplos adicionales de interpretación de modelos</a>
<ul>
<li class="chapter" data-level="3.14.1" data-path="regresión-lineal.html"><a href="regresión-lineal.html#interpretación-del-intercept-y-los-coeficientes-beta-para-un-modelo-con-predictores-continuos"><i class="fa fa-check"></i><b>3.14.1</b> Interpretación del <em>intercept</em> y los coeficientes <span class="math inline">\(\beta\)</span> para un modelo con predictores continuos</a></li>
<li class="chapter" data-level="3.14.2" data-path="regresión-lineal.html"><a href="regresión-lineal.html#interpretación-del-intercept-y-los-coeficientes-beta-para-un-modelo-con-predictores-binarios-y-continuos"><i class="fa fa-check"></i><b>3.14.2</b> Interpretación del <em>intercept</em> y los coeficientes <span class="math inline">\(\beta\)</span> para un modelo con predictores binarios y continuos</a></li>
<li class="chapter" data-level="3.14.3" data-path="regresión-lineal.html"><a href="regresión-lineal.html#interpretación-del-intercept-y-los-coeficientes-beta-para-un-modelo-con-predictores-binarios-y-continuos-con-interacciones"><i class="fa fa-check"></i><b>3.14.3</b> Interpretación del <em>intercept</em> y los coeficientes <span class="math inline">\(\beta\)</span> para un modelo con predictores binarios y continuos, con interacciones</a></li>
<li class="chapter" data-level="3.14.4" data-path="regresión-lineal.html"><a href="regresión-lineal.html#interpretación-del-intercept-y-los-coeficientes-beta-para-un-modelo-con-predictores-continuos-con-interacciones"><i class="fa fa-check"></i><b>3.14.4</b> Interpretación del <em>intercept</em> y los coeficientes <span class="math inline">\(\beta\)</span> para un modelo con predictores continuos, con interacciones</a></li>
</ul></li>
<li class="chapter" data-level="3.15" data-path="regresión-lineal.html"><a href="regresión-lineal.html#centrado-y-escalado"><i class="fa fa-check"></i><b>3.15</b> Centrado y escalado</a></li>
<li class="chapter" data-level="3.16" data-path="introducción-a-tidyverse.html"><a href="introducción-a-tidyverse.html#transformación-de-datos"><i class="fa fa-check"></i><b>3.16</b> Transformación de datos</a></li>
<li class="chapter" data-level="3.17" data-path="regresión-lineal.html"><a href="regresión-lineal.html#colinealidad"><i class="fa fa-check"></i><b>3.17</b> Colinealidad</a></li>
<li class="chapter" data-level="3.18" data-path="regresión-lineal.html"><a href="regresión-lineal.html#valores-atípicos"><i class="fa fa-check"></i><b>3.18</b> Valores atípicos</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aprendizaje Automático 1</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="introducción-a-tidyverse" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Introducción a Tidyverse</h1>
<div id="introducción" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Introducción</h2>
<center>
<div class="figure">
<img src="fig/tidiverse.png" width="450" alt="" />
<p class="caption">Tidyverse</p>
</div>
</center>
<p><a href="https://www.tidyverse.org/">tidyverse</a> es una forma elegante de usar R y hacer de este software una herramienta mejorada. Ha sido diseñado por <a href="http://hadley.nz/">Hadley / Rstudio</a> e incluye distintas librería que siguen las reglas principales del manifiesto de <a href="https://mran.microsoft.com/web/packages/tidyverse/vignettes/manifesto.html">The tidy tools</a>. Los autores describen esta nueva implementación como:</p>
<p><code>tidyverse es un conjunto de librerías que funcionan en armonía porque comparten representaciones de datos comunes y diseño de API. El paquete tidyverse está diseñado para facilitar la instalación y carga de los paquetes principales desde el tidyverse en un solo comando.</code></p>
<p>Existen numeros ayudas, cursos y material en general para aprender todo sobre las librerías de tidyverse, pero el autor ha usado el libro <a href="https://r4ds.had.co.nz/">R for Data Science</a> como base para ilustrar cómo usar este conjunto de herramientas para el análisis de datos en ciencias. Este libro (del que os he puesto el link) es una excelente fuente para aprender todo sobre <code>tidyverse</code>. En este capítulo os referenciaré otro material que puede ser de ayuda.</p>
<p>El libro de <a href="https://r4ds.had.co.nz/">R for Data Science</a> se organiza siguiendo este esquema:</p>
<div class="figure"><span id="fig:flujo"></span>
<img src="fig/flujoTrabajoAnalsisiDatos.gif" alt="Esquema R for Data Science" width="100%" />
<p class="caption">
Figure 2.1: Esquema R for Data Science
</p>
</div>
<p>De forma que las librerías incluidas en <code>tidyverse</code> cubren todos estos aspectos. Está pensado para facilitar tareas de gestión de datos, y en su caso, el manejo de grandes volúmenes de información de forma eficiente. Se describen técnicas que ayudan a la visualización de datos que es el primer paso que se debe llevar a cabo en cualquier análisis estadístico que se precie. Esta visualización y posterior análisis no sólo deber llevarse a cab o en toda la base de datos, puede requerirse analizar subconjuntos de datos obtenidos mediante algún filtro o inlcuso puede necesitarse recodificar o restructurar la información disponible . Quizás estos sean los procedimientos para los que <code>tidiverse</code> mejore de forma sustancial el uso de R tradicional (junto con la forma compacta y clara de escribir código), ya que la posterior modelización puede llevarse a cabo con decenas de librerías diseñadas para tal efecto.</p>
</div>
<div id="instalación" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Instalación</h2>
<p>Para instalar el conjunto básico de liberías relacionadas con <code>tidyverse</code> basta con ejecutar_</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="introducción-a-tidyverse.html#cb1-1"></a><span class="kw">install.package</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p>Las librerías básicas relacionadas con <code>tidyverse</code> se cargan de la forma usual, con una única llamada</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="introducción-a-tidyverse.html#cb2-1"></a><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p>La diferencia con el hecho de cargar cualquier otra librería, es que en un sólo comando se instalan/cargan un par de docenas de paquetes. Como beneficio adicional, uno puede estar seguro de que todos los paquetes instalados / cargados son de versiones compatibles.</p>
</div>
<div id="librerías-básicas" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Librerías básicas</h2>
<ul>
<li><p>Las librerías que son más conocidas y ampliamente utilizadas en <code>tidyverse</code> son:</p>
<ul>
<li><strong>ggplot2</strong>: visualización avanzada de datos</li>
<li><strong>dplyr</strong>: manipulación de datos de forma eficiente y escalable (usa Rcpp)</li>
<li><strong>tidyr</strong>: funciones para ordenar datos</li>
<li><strong>readr</strong>: importa datos.</li>
<li><strong>purrr</strong>: desarrolla una especie de “dialecto” de R que facilita muchas operaciones (map, Reduce, …)</li>
<li><strong>tibble</strong>: forma moderna para conceptualizar los datos.</li>
<li><strong>magrittr</strong>: canalización para hacer el código más legible (uso del “pipe” %&gt;%)</li>
</ul></li>
<li><p>Paquetes para manipular formatos de datos específicos:</p>
<ul>
<li><strong>hms</strong>: leer fácilmente fechas y tiempos</li>
<li><strong>stringr</strong>: funciones para trabajar de forma sencilla con cadenas de carácteres</li>
<li><strong>Lubridate</strong>: Manipulación avanzada de fechas</li>
<li><strong>Forcats</strong>: funciones avanzadas con factores</li>
</ul></li>
<li><p>Importar datos:</p>
<ul>
<li><strong>DBI</strong>: define una interfaz común entre R y los sistemas de administración de bases de datos (DBMS)</li>
<li><strong>haven</strong>: importar archivos SPSS, SAS y Stata de forma sencilla</li>
<li><strong>httr</strong>: facilitar el uso del paquete curl personalizado las necesidades de las API web modernas</li>
<li><strong>jsonlite</strong>: análisis y generación de JSON rápido y optimizado para obtener estadísticas en la web</li>
<li><strong>readxl</strong>: leer archivos read.xls y .xlsx de forma sencilla y sin necesitar otras dependencias</li>
<li><strong>rvest</strong>: obtener información de páginas web</li>
<li><strong>xml2</strong>: trabajar con XML</li>
</ul></li>
<li><p>Modelización: Existen varias librerías, pero yo prefiero usar las de R y/o Bioconductor</p></li>
</ul>
</div>
<div id="manejo-de-datos" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Manejo de datos</h2>
<p>En tidyverse, los data.frames se trabajan como <strong>tibbles</strong>. Esto permite disponer de una forma consistente y eficiente de guardar nuestros datos permitiendo una forma sencilla de hacer transformaciones, visualización y modelización. Esta sección pretende ser una introducción básica a <code>tidyverse</code> por lo que sólo veremos cómo llevar a cabo los principales tipos de manipulación de datos. No obstante, también existen funciones específicas para:</p>
<ul>
<li>Relacionar múltiples tablas <a href="https://rpubs.com/williamsurles/293454">ver ejemplos</a>.</li>
<li>Trabajar con variables carácter</li>
<li>Usar factores para variables categóricas de forma sencilla (sin los problemas de orden de categorías)</li>
<li>Realizar operaciones con variables de tipo fecha <a href="https://rpubs.com/carloslesmes/474297">ver ejemplos</a>.</li>
</ul>
<div id="tibbles" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Tibbles</h3>
<p>Empecemos introduciendo lo que es un <em>tibble</em> (pronunciado “tibel”). Se puede aprender más cosas ejecutando <code>vignette("tibble")</code> en la consola de RStudio. Tras cargar la librería <code>tidyverse</code> podemos crear un tibble a partir de un data.frame de la siguiente forma. Usaremos la base de datos iris a modo de ejemplo</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="introducción-a-tidyverse.html#cb3-1"></a><span class="kw">head</span>(iris)</span></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species         Y
## 1          5.1         3.5          1.4         0.2  setosa 11.492934
## 2          4.9         3.0          1.4         0.2  setosa 11.377429
## 3          4.7         3.2          1.3         0.2  setosa 12.824441
## 4          4.6         3.1          1.5         0.2  setosa  9.074302
## 5          5.0         3.6          1.4         0.2  setosa 13.449125
## 6          5.4         3.9          1.7         0.4  setosa 14.486056</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="introducción-a-tidyverse.html#cb5-1"></a>iris.tib &lt;-<span class="st"> </span><span class="kw">tibble</span>(iris)</span>
<span id="cb5-2"><a href="introducción-a-tidyverse.html#cb5-2"></a>iris.tib</span></code></pre></div>
<pre><code>## # A tibble: 150 x 6
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species     Y
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;   &lt;dbl&gt;
##  1          5.1         3.5          1.4         0.2 setosa  11.5 
##  2          4.9         3            1.4         0.2 setosa  11.4 
##  3          4.7         3.2          1.3         0.2 setosa  12.8 
##  4          4.6         3.1          1.5         0.2 setosa   9.07
##  5          5           3.6          1.4         0.2 setosa  13.4 
##  6          5.4         3.9          1.7         0.4 setosa  14.5 
##  7          4.6         3.4          1.4         0.3 setosa  11.8 
##  8          5           3.4          1.5         0.2 setosa  11.8 
##  9          4.4         2.9          1.4         0.2 setosa  10.2 
## 10          4.9         3.1          1.5         0.1 setosa  10.5 
## # ... with 140 more rows</code></pre>
<p>También podemos crear un nuevo <em>tibble</em> mediante (los datos se reciclan):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="introducción-a-tidyverse.html#cb7-1"></a><span class="kw">tibble</span>(</span>
<span id="cb7-2"><a href="introducción-a-tidyverse.html#cb7-2"></a>  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, </span>
<span id="cb7-3"><a href="introducción-a-tidyverse.html#cb7-3"></a>  <span class="dt">y =</span> <span class="dv">1</span>, </span>
<span id="cb7-4"><a href="introducción-a-tidyverse.html#cb7-4"></a>  <span class="dt">z =</span> x <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y</span>
<span id="cb7-5"><a href="introducción-a-tidyverse.html#cb7-5"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##       x     y     z
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     1     2
## 2     2     1     5
## 3     3     1    10
## 4     4     1    17
## 5     5     1    26</code></pre>
<p>NOTA 1: Nunca cambia los tipos de datos! (i.e. caracter a factor)
NOTA 2: El <code>rownames</code> desaparece</p>
<p>Quizás uno de los aspectos más novedosos de las <em>tibble</em> sea que se ha re-definido el método <code>print()</code> que permite, por defecto, ver las 10 primeras filas y todas las columnas que quepan en la pantalla. Esto puede cambiarse con</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="introducción-a-tidyverse.html#cb9-1"></a><span class="kw">print</span>(iris.tib, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">width =</span> <span class="ot">Inf</span>)</span></code></pre></div>
<pre><code>## # A tibble: 150 x 6
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species     Y
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;   &lt;dbl&gt;
##  1          5.1         3.5          1.4         0.2 setosa  11.5 
##  2          4.9         3            1.4         0.2 setosa  11.4 
##  3          4.7         3.2          1.3         0.2 setosa  12.8 
##  4          4.6         3.1          1.5         0.2 setosa   9.07
##  5          5           3.6          1.4         0.2 setosa  13.4 
##  6          5.4         3.9          1.7         0.4 setosa  14.5 
##  7          4.6         3.4          1.4         0.3 setosa  11.8 
##  8          5           3.4          1.5         0.2 setosa  11.8 
##  9          4.4         2.9          1.4         0.2 setosa  10.2 
## 10          4.9         3.1          1.5         0.1 setosa  10.5 
## # ... with 140 more rows</code></pre>
<p>ó</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="introducción-a-tidyverse.html#cb11-1"></a><span class="kw">print</span>(iris.tib, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">width =</span> <span class="dv">25</span>)</span></code></pre></div>
<pre><code>## # A tibble: 150 x 6
##    Sepal.Length
##           &lt;dbl&gt;
##  1          5.1
##  2          4.9
##  3          4.7
##  4          4.6
##  5          5  
##  6          5.4
##  7          4.6
##  8          5  
##  9          4.4
## 10          4.9
## # ... with 140 more
## #   rows, and 5 more
## #   variables:
## #   Sepal.Width &lt;dbl&gt;,
## #   Petal.Length &lt;dbl&gt;,
## #   Petal.Width &lt;dbl&gt;,
## #   Species &lt;fct&gt;,
## #   Y &lt;dbl&gt;</code></pre>
<p>Podemos acceder a una columna (e.g. variable) de la misma forma que con un data.frame</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="introducción-a-tidyverse.html#cb13-1"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb13-2"><a href="introducción-a-tidyverse.html#cb13-2"></a>  <span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">5</span>),</span>
<span id="cb13-3"><a href="introducción-a-tidyverse.html#cb13-3"></a>  <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb13-4"><a href="introducción-a-tidyverse.html#cb13-4"></a>)</span>
<span id="cb13-5"><a href="introducción-a-tidyverse.html#cb13-5"></a></span>
<span id="cb13-6"><a href="introducción-a-tidyverse.html#cb13-6"></a><span class="co"># Extract by name</span></span>
<span id="cb13-7"><a href="introducción-a-tidyverse.html#cb13-7"></a>df<span class="op">$</span>x</span></code></pre></div>
<pre><code>## [1] 0.11263386 0.99747715 0.05467677 0.36455551 0.07494088</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="introducción-a-tidyverse.html#cb15-1"></a>df[[<span class="st">&quot;x&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] 0.11263386 0.99747715 0.05467677 0.36455551 0.07494088</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="introducción-a-tidyverse.html#cb17-1"></a><span class="co"># Extract by position</span></span>
<span id="cb17-2"><a href="introducción-a-tidyverse.html#cb17-2"></a>df[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] 0.11263386 0.99747715 0.05467677 0.36455551 0.07494088</code></pre>
</div>
<div id="importar-datos" class="section level3" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Importar datos</h3>
<p>El paquete clave para leer datos es <em>readr</em></p>
<ul>
<li><p><em>read_csv ()</em> lee archivos delimitados por comas, <em>read_csv2 () </em> lee archivos separados por punto y coma (común en países donde, se usa como el lugar decimal), <em>read_tsv () </em> lee archivos delimitados por tabulaciones y <em>read_delim () </em> lee archivos con cualquier delimitador.</p></li>
<li><p><em>read_fwf ()</em> lee archivos de ancho fijo. Se puede especificar campos por sus anchos con <em>fwf_widths ()</em> o su posición con <em>fwf_positions ()</em>. <em>read_table ()</em> lee archivos de ancho fijo donde las columnas están separadas por espacios en blanco.</p></li>
<li><p><em>read_log ()</em> lee archivos de registro de estilo Apache (servidor web de código abierto). Pero también es muy útil <em>webreadr</em>, que está construido sobre <em>read_log ()</em> y proporciona muchas más herramientas útiles.</p></li>
</ul>
<p>Estas funciones suelen ser mucho más rápidas (~ 10x) que sus equivalentes en R básico. Además, la importación de datos de ejecución prolongada tienen una barra de progreso para que se pueda ver lo que está sucediendo. Si se está buscando velocidad bruta, también podemos usar <em>data.table::fread()</em> que aunque no encaja tan bien en <code>tidyverse</code> puede usarse en ocasiones donde precie la velocidad (pero no es mucho más rápido). Los datos se importan como objetos que:</p>
<ul>
<li>son *tibbles</li>
<li>no convierten vectores de caracteres en factores</li>
<li>no usan nombres de filas ni modifican los nombres de columnas. Éstas son fuentes comunes de frustración con las funciones base R [¡declaración de Hadley!].</li>
<li>Son más reproducibles. Las funciones de Base R heredan algún comportamiento de su sistema operativo y variables de entorno, por lo que el código para importar datos que funciona en un ordenador, podría no funcionar en el de otra persona.</li>
</ul>
<p>Hagamos una comparación con un archivo grande</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="introducción-a-tidyverse.html#cb19-1"></a><span class="kw">library</span>(readr)</span>
<span id="cb19-2"><a href="introducción-a-tidyverse.html#cb19-2"></a><span class="kw">system.time</span>(dd1 &lt;-<span class="st"> </span><span class="kw">read.delim</span>(<span class="st">&quot;data/genome.txt&quot;</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##    2.46    0.01    2.47</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="introducción-a-tidyverse.html#cb21-1"></a><span class="kw">system.time</span>(dd2 &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&quot;data/genome.txt&quot;</span>, <span class="dt">delim=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##    0.42    0.00    0.42</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="introducción-a-tidyverse.html#cb23-1"></a><span class="kw">dim</span>(dd2)</span></code></pre></div>
<pre><code>## [1] 733202      5</code></pre>
<p>Efectivamente ambos objetos contienen la misma información</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="introducción-a-tidyverse.html#cb25-1"></a><span class="kw">head</span>(dd1)</span></code></pre></div>
<pre><code>##         Name Chr  Position  Log.R.Ratio B.Allele.Freq
## 1  rs1000000  12 125456933 -0.002501764   1.000000000
## 2  rs1000002   3 185118461 -0.029741180   0.000336171
## 3 rs10000023   4  95952928  0.004015533   0.460671800
## 4  rs1000003   3  99825597 -0.142527700   0.541123600
## 5 rs10000030   4 103593179  0.365104000   1.000000000
## 6 rs10000037   4  38600725 -0.005177616   0.504625300</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="introducción-a-tidyverse.html#cb27-1"></a>dd2</span></code></pre></div>
<pre><code>## # A tibble: 733,202 x 5
##    Name       Chr    Position Log.R.Ratio B.Allele.Freq
##    &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;       &lt;dbl&gt;         &lt;dbl&gt;
##  1 rs1000000  12    125456933    -0.00250      1       
##  2 rs1000002  3     185118461    -0.0297       0.000336
##  3 rs10000023 4      95952928     0.00402      0.461   
##  4 rs1000003  3      99825597    -0.143        0.541   
##  5 rs10000030 4     103593179     0.365        1       
##  6 rs10000037 4      38600725    -0.00518      0.505   
##  7 rs10000041 4     165841405    -0.179        0       
##  8 rs10000042 4       5288053     0.168        0.998   
##  9 rs10000049 4     119167668    -0.00238      0       
## 10 rs1000007  2     237416793    -0.00411      0       
## # ... with 733,192 more rows</code></pre>
</div>
<div id="transformación-de-datos" class="section level3" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Transformación de datos</h3>
<p>Antes de empezar a analizar los datos suele ser necesario realizar algunas transformaciones o crear nuevas variables ya que:</p>
<ul>
<li>Es raro que obtengamos los datos exactamente en la forma correcta que necesitamos.</li>
<li>A menudo, se deberán crear algunas variables o resúmenes nuevos.</li>
<li>A veces se necesita cambiar el nombre de las variables o reordenar las observaciones para que sea un poco más fácil trabajar con los datos.</li>
</ul>
<p>Ilustremos cómo realizar estas tareas utilizando los datos disponibles en una base de datos de vuelos de NYC. El objeto <code>nycflights13::fligths</code> contiene los 336,776 vuelos que partieron de la ciudad de Nueva York en 2013. Los datos provienen de la Oficina de Estadísticas de Transporte de EE. UU. y están documentados en <code>?flights</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="introducción-a-tidyverse.html#cb29-1"></a><span class="kw">library</span>(nycflights13)</span>
<span id="cb29-2"><a href="introducción-a-tidyverse.html#cb29-2"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="introducción-a-tidyverse.html#cb30-1"></a>flights</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138
## # ... with 336,766 more rows, and 4 more variables: distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Las funciones básicas que usaremos están disponibles en la librería <code>dlpyr</code> y son las siguientes:</p>
<ul>
<li><p>Pick observations by their values: <code>filter()</code>.</p></li>
<li><p>Reorder the rows: <code>arrange()</code>.</p></li>
<li><p>Pick variables by their names: <code>select()</code>.</p></li>
<li><p>Create new variables with functions of existing variables: <code>mutate()</code>.</p></li>
<li><p>Collapse many values down to a single summary: <code>summarise()</code>.</p></li>
<li><p>Elegir observaciones por sus valores: <code>filter()</code>.</p></li>
<li><p>Reordenar las filas: <code>arrange()</code>.</p></li>
<li><p>Elegir las variables por sus nombres: <code>select()</code>.</p></li>
<li><p>Crear nuevas variables a partir de variables existentes: <code>mutate()</code>.</p></li>
<li><p>Colapsar valores en un sólo resumen: <code>summarise()</code>.</p></li>
</ul>
<p>Todos los <strong>verbos</strong> (e.g funciones) se usan de la misma forma:</p>
<ul>
<li><p>El primer argumento es un <em>tibble</em> o un <em>data.frame</em>.</p></li>
<li><p>Los argumentos siguientes describen qué hacer con los datos, utilizando los nombres de las variables (sin comillas).</p></li>
<li><p>El resultado es un nuevo <em>tibble</em>.</p></li>
</ul>
</div>
<div id="filtrar-filas" class="section level3" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Filtrar filas</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="introducción-a-tidyverse.html#cb32-1"></a>jan1 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<p>R imprime los resultados o los guarda en una variable. Si desea hacer ambas cosas, podemos envolver la sintaxis entre paréntesis:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="introducción-a-tidyverse.html#cb33-1"></a>(jan1 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## # A tibble: 842 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138
## # ... with 832 more rows, and 4 more variables: distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="filtrado-lógico" class="section level3" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> Filtrado lógico</h3>
<p>Estos son los operadoles lógicos que podemos aplicar</p>
<div class="figure">
<img src="fig/transform-logical.png" alt="" />
<p class="caption">boolean operations</p>
</div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="introducción-a-tidyverse.html#cb35-1"></a><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">11</span> <span class="op">|</span><span class="st"> </span>month <span class="op">==</span><span class="st"> </span><span class="dv">12</span>)</span></code></pre></div>
<pre><code>## # A tibble: 55,403 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
##  1  2013    11     1        5           2359         6      352            345         7 B6         745 N568JB  JFK    PSE        205
##  2  2013    11     1       35           2250       105      123           2356        87 B6        1816 N353JB  JFK    SYR         36
##  3  2013    11     1      455            500        -5      641            651       -10 US        1895 N192UW  EWR    CLT         88
##  4  2013    11     1      539            545        -6      856            827        29 UA        1714 N38727  LGA    IAH        229
##  5  2013    11     1      542            545        -3      831            855       -24 AA        2243 N5CLAA  JFK    MIA        147
##  6  2013    11     1      549            600       -11      912            923       -11 UA         303 N595UA  JFK    SFO        359
##  7  2013    11     1      550            600       -10      705            659         6 US        2167 N748UW  LGA    DCA         57
##  8  2013    11     1      554            600        -6      659            701        -2 US        2134 N742PS  LGA    BOS         40
##  9  2013    11     1      554            600        -6      826            827        -1 DL         563 N912DE  LGA    ATL        126
## 10  2013    11     1      554            600        -6      749            751        -2 DL         731 N315NB  LGA    DTW         93
## # ... with 55,393 more rows, and 4 more variables: distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="introducción-a-tidyverse.html#cb37-1"></a><span class="kw">filter</span>(flights, <span class="op">!</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span> <span class="op">|</span><span class="st"> </span>dep_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>))</span></code></pre></div>
<pre><code>## # A tibble: 316,050 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138
## # ... with 316,040 more rows, and 4 more variables: distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="ordenar-filas" class="section level3" number="2.4.6">
<h3><span class="header-section-number">2.4.6</span> Ordenar filas</h3>
<p>En orden ascendente</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="introducción-a-tidyverse.html#cb39-1"></a><span class="kw">arrange</span>(flights, year, month, day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138
## # ... with 336,766 more rows, and 4 more variables: distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>y descendente</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="introducción-a-tidyverse.html#cb41-1"></a><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(dep_delay))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
##  1  2013     1     9      641            900      1301     1242           1530      1272 HA          51 N384HA  JFK    HNL        640
##  2  2013     6    15     1432           1935      1137     1607           2120      1127 MQ        3535 N504MQ  JFK    CMH         74
##  3  2013     1    10     1121           1635      1126     1239           1810      1109 MQ        3695 N517MQ  EWR    ORD        111
##  4  2013     9    20     1139           1845      1014     1457           2210      1007 AA         177 N338AA  JFK    SFO        354
##  5  2013     7    22      845           1600      1005     1044           1815       989 MQ        3075 N665MQ  JFK    CVG         96
##  6  2013     4    10     1100           1900       960     1342           2211       931 DL        2391 N959DL  JFK    TPA        139
##  7  2013     3    17     2321            810       911      135           1020       915 DL        2119 N927DA  LGA    MSP        167
##  8  2013     6    27      959           1900       899     1236           2226       850 DL        2007 N3762Y  JFK    PDX        313
##  9  2013     7    22     2257            759       898      121           1026       895 DL        2047 N6716C  LGA    ATL        109
## 10  2013    12     5      756           1700       896     1058           2020       878 AA         172 N5DMAA  EWR    MIA        149
## # ... with 336,766 more rows, and 4 more variables: distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>NOTA: los valores missing están situados al final</p>
</div>
<div id="seleccionar-columnas-e.g.-variables" class="section level3" number="2.4.7">
<h3><span class="header-section-number">2.4.7</span> Seleccionar columnas (e.g. variables)</h3>
<p>Seleccionamos las columnas que queremos</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="introducción-a-tidyverse.html#cb43-1"></a>dplyr<span class="op">::</span><span class="kw">select</span>(flights, year, month, day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
<p>o las que están entre dos columnas</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="introducción-a-tidyverse.html#cb45-1"></a>dplyr<span class="op">::</span><span class="kw">select</span>(flights, year<span class="op">:</span>day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
<p>también podemos seleccionar todas las columnas menos algunas</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="introducción-a-tidyverse.html#cb47-1"></a>dplyr<span class="op">::</span><span class="kw">select</span>(flights, <span class="op">-</span>(year<span class="op">:</span>day))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 16
##    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour minute
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5     15
##  2      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5     29
##  3      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5     40
##  4      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5     45
##  5      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6      0
##  6      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5     58
##  7      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6      0
##  8      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6      0
##  9      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6      0
## 10      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6      0
## # ... with 336,766 more rows, and 1 more variable: time_hour &lt;dttm&gt;</code></pre>
<p>Existen numerosas funciones que pueden ser de mucha utilidad para hacer selecciones más complejas y rápidas dentro de la función <code>select()</code></p>
<ul>
<li><p><code>starts_with("abc")</code>: nombres que empiezan con “abc”.</p></li>
<li><p><code>ends_with("xyz")</code>: nombres que acaban con “xyz”.</p></li>
<li><p><code>contains("ijk")</code>: nombres que contienen “ijk”.</p></li>
<li><p><code>matches("(.)\\1")</code>: selecciona variables que coinciden con una expresión regular. Se puede aprender más con <code>strings</code>.</p></li>
<li><p><code>num_range("x", 1:3)</code>: coincide con x1, x2 and x3.</p></li>
</ul>
</div>
<div id="añadir-nuevas-variables" class="section level3" number="2.4.8">
<h3><span class="header-section-number">2.4.8</span> Añadir nuevas variables</h3>
<p>Debemos usar la función <code>mutate()</code></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="introducción-a-tidyverse.html#cb49-1"></a>flights_sml &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(flights, </span>
<span id="cb49-2"><a href="introducción-a-tidyverse.html#cb49-2"></a>  year<span class="op">:</span>day, </span>
<span id="cb49-3"><a href="introducción-a-tidyverse.html#cb49-3"></a>  <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), </span>
<span id="cb49-4"><a href="introducción-a-tidyverse.html#cb49-4"></a>  distance, </span>
<span id="cb49-5"><a href="introducción-a-tidyverse.html#cb49-5"></a>  air_time</span>
<span id="cb49-6"><a href="introducción-a-tidyverse.html#cb49-6"></a>)</span>
<span id="cb49-7"><a href="introducción-a-tidyverse.html#cb49-7"></a><span class="kw">mutate</span>(flights_sml,</span>
<span id="cb49-8"><a href="introducción-a-tidyverse.html#cb49-8"></a>  <span class="dt">gain =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay,</span>
<span id="cb49-9"><a href="introducción-a-tidyverse.html#cb49-9"></a>  <span class="dt">speed =</span> distance <span class="op">/</span><span class="st"> </span>air_time <span class="op">*</span><span class="st"> </span><span class="dv">60</span></span>
<span id="cb49-10"><a href="introducción-a-tidyverse.html#cb49-10"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 9
##     year month   day dep_delay arr_delay distance air_time  gain speed
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227    -9  370.
##  2  2013     1     1         4        20     1416      227   -16  374.
##  3  2013     1     1         2        33     1089      160   -31  408.
##  4  2013     1     1        -1       -18     1576      183    17  517.
##  5  2013     1     1        -6       -25      762      116    19  394.
##  6  2013     1     1        -4        12      719      150   -16  288.
##  7  2013     1     1        -5        19     1065      158   -24  404.
##  8  2013     1     1        -3       -14      229       53    11  259.
##  9  2013     1     1        -3        -8      944      140     5  405.
## 10  2013     1     1        -2         8      733      138   -10  319.
## # ... with 336,766 more rows</code></pre>
<p>Si sólo queremos mantener las nuevas variables en nuestra tabla de datos, debemos usar <code>transmute()</code>:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="introducción-a-tidyverse.html#cb51-1"></a><span class="kw">transmute</span>(flights,</span>
<span id="cb51-2"><a href="introducción-a-tidyverse.html#cb51-2"></a>  <span class="dt">gain =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay,</span>
<span id="cb51-3"><a href="introducción-a-tidyverse.html#cb51-3"></a>  <span class="dt">hours =</span> air_time <span class="op">/</span><span class="st"> </span><span class="dv">60</span>,</span>
<span id="cb51-4"><a href="introducción-a-tidyverse.html#cb51-4"></a>  <span class="dt">gain_per_hour =</span> gain <span class="op">/</span><span class="st"> </span>hours</span>
<span id="cb51-5"><a href="introducción-a-tidyverse.html#cb51-5"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     gain hours gain_per_hour
##    &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1    -9 3.78          -2.38
##  2   -16 3.78          -4.23
##  3   -31 2.67         -11.6 
##  4    17 3.05           5.57
##  5    19 1.93           9.83
##  6   -16 2.5           -6.4 
##  7   -24 2.63          -9.11
##  8    11 0.883         12.5 
##  9     5 2.33           2.14
## 10   -10 2.3           -4.35
## # ... with 336,766 more rows</code></pre>
</div>
<div id="grouped-summaries" class="section level3" number="2.4.9">
<h3><span class="header-section-number">2.4.9</span> Grouped summaries</h3>
<p>Podemos agrupar variables de la siguiente forma:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="introducción-a-tidyverse.html#cb53-1"></a><span class="kw">summarise</span>(flights, <span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   delay
##   &lt;dbl&gt;
## 1  12.6</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="introducción-a-tidyverse.html#cb55-1"></a>by_day &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, year, month, day)</span>
<span id="cb55-2"><a href="introducción-a-tidyverse.html#cb55-2"></a><span class="kw">summarise</span>(by_day, <span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.5 
##  2  2013     1     2 13.9 
##  3  2013     1     3 11.0 
##  4  2013     1     4  8.95
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.55
##  9  2013     1     9  2.28
## 10  2013     1    10  2.84
## # ... with 355 more rows</code></pre>
<p>También podemos agrupar según varios criterios</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="introducción-a-tidyverse.html#cb57-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb57-2"><a href="introducción-a-tidyverse.html#cb57-2"></a><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-3"><a href="introducción-a-tidyverse.html#cb57-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb57-4"><a href="introducción-a-tidyverse.html#cb57-4"></a>    <span class="dt">avg_delay1 =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb57-5"><a href="introducción-a-tidyverse.html#cb57-5"></a>    <span class="dt">avg_delay2 =</span> <span class="kw">mean</span>(arr_delay[arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>], <span class="dt">na.rm=</span><span class="ot">TRUE</span>) </span>
<span id="cb57-6"><a href="introducción-a-tidyverse.html#cb57-6"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 365 x 5
## # Groups:   year, month [12]
##     year month   day avg_delay1 avg_delay2
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1  2013     1     1     12.7         32.5
##  2  2013     1     2     12.7         32.0
##  3  2013     1     3      5.73        27.7
##  4  2013     1     4     -1.93        28.3
##  5  2013     1     5     -1.53        22.6
##  6  2013     1     6      4.24        24.4
##  7  2013     1     7     -4.95        27.8
##  8  2013     1     8     -3.23        20.8
##  9  2013     1     9     -0.264       25.6
## 10  2013     1    10     -5.90        27.3
## # ... with 355 more rows</code></pre>
<p>Existen otras funciones útiles por las que nos podría interesar agrupar</p>
<ul>
<li><code>count()</code></li>
<li><code>mean()</code></li>
<li><code>median()</code></li>
<li><code>min()</code></li>
<li><code>max()</code></li>
<li><code>quantile(x, 0.25)</code></li>
<li><code>IQR()</code></li>
<li><code>mad()</code></li>
</ul>
</div>
</div>
<div id="uso-del-pipe" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Uso del pipe <code>%&gt;%</code></h2>
<p>Imaginemos que queremos explorar la relación entre la distancia y el retraso promedio para cada ubicación. Los pasos para obtener esta información serían:</p>
<ul>
<li><p>Agrupar los vuelos por destino.</p></li>
<li><p>Resumir la información calculando la distancia, el retraso promedio y el número de vuelos.</p></li>
<li><p>Filtrar algunos valores que introducen ruido (producen sesgo) como el aeropuerto de Honolulu, que está casi el doble de lejos que el siguiente aeropuerto más cercano.</p></li>
</ul>
<p>Utilizando <code>dplyr</code> escribiríamos algo como esto (aún más largo en R tradicional y menos legible):</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="introducción-a-tidyverse.html#cb59-1"></a>by_dest &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, dest)</span>
<span id="cb59-2"><a href="introducción-a-tidyverse.html#cb59-2"></a>delay &lt;-<span class="st"> </span><span class="kw">summarise</span>(by_dest,</span>
<span id="cb59-3"><a href="introducción-a-tidyverse.html#cb59-3"></a>  <span class="dt">count =</span> <span class="kw">n</span>(),</span>
<span id="cb59-4"><a href="introducción-a-tidyverse.html#cb59-4"></a>  <span class="dt">dist =</span> <span class="kw">mean</span>(distance, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb59-5"><a href="introducción-a-tidyverse.html#cb59-5"></a>  <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb59-6"><a href="introducción-a-tidyverse.html#cb59-6"></a>)</span>
<span id="cb59-7"><a href="introducción-a-tidyverse.html#cb59-7"></a>delay &lt;-<span class="st"> </span><span class="kw">filter</span>(delay, count <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>, dest <span class="op">!=</span><span class="st"> &quot;HNL&quot;</span>)</span>
<span id="cb59-8"><a href="introducción-a-tidyverse.html#cb59-8"></a>delay</span></code></pre></div>
<pre><code>## # A tibble: 96 x 4
##    dest  count  dist delay
##    &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 ABQ     254 1826   4.38
##  2 ACK     265  199   4.85
##  3 ALB     439  143  14.4 
##  4 ATL   17215  757. 11.3 
##  5 AUS    2439 1514.  6.02
##  6 AVL     275  584.  8.00
##  7 BDL     443  116   7.05
##  8 BGR     375  378   8.03
##  9 BHM     297  866. 16.9 
## 10 BNA    6333  758. 11.8 
## # ... with 86 more rows</code></pre>
<p>Y podríamos tener un gráfico de la siguiente forma (veremos cómo hacer esto en la siguiente sesión)</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="introducción-a-tidyverse.html#cb61-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> delay, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">y =</span> delay)) <span class="op">+</span></span>
<span id="cb61-2"><a href="introducción-a-tidyverse.html#cb61-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> count), <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb61-3"><a href="introducción-a-tidyverse.html#cb61-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_pipe-1.png" width="672" /></p>
<p>Utilizando <em>pipe</em>s el código quedaría mucho más compacto y legible</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="introducción-a-tidyverse.html#cb62-1"></a>delays &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb62-2"><a href="introducción-a-tidyverse.html#cb62-2"></a><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb62-3"><a href="introducción-a-tidyverse.html#cb62-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb62-4"><a href="introducción-a-tidyverse.html#cb62-4"></a>    <span class="dt">count =</span> <span class="kw">n</span>(),</span>
<span id="cb62-5"><a href="introducción-a-tidyverse.html#cb62-5"></a>    <span class="dt">dist =</span> <span class="kw">mean</span>(distance, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb62-6"><a href="introducción-a-tidyverse.html#cb62-6"></a>    <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb62-7"><a href="introducción-a-tidyverse.html#cb62-7"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb62-8"><a href="introducción-a-tidyverse.html#cb62-8"></a><span class="st">  </span><span class="kw">filter</span>(count <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>, dest <span class="op">!=</span><span class="st"> &quot;HNL&quot;</span>)</span>
<span id="cb62-9"><a href="introducción-a-tidyverse.html#cb62-9"></a>delays</span></code></pre></div>
<pre><code>## # A tibble: 96 x 4
##    dest  count  dist delay
##    &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 ABQ     254 1826   4.38
##  2 ACK     265  199   4.85
##  3 ALB     439  143  14.4 
##  4 ATL   17215  757. 11.3 
##  5 AUS    2439 1514.  6.02
##  6 AVL     275  584.  8.00
##  7 BDL     443  116   7.05
##  8 BGR     375  378   8.03
##  9 BHM     297  866. 16.9 
## 10 BNA    6333  758. 11.8 
## # ... with 86 more rows</code></pre>
</div>
<div id="ejercicios-manejo-de-datos" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Ejercicios (manejo de datos)</h2>
<p>Los siguientes ejercicios os ayudarán a trabajar con las tareas más básicas de <code>dplyr</code>. <strong>Debéis realizarlos usando las funciones que hemos visto en esta presentación - no vale usar código R básico</strong>. Usaremos los datos <code>mtcars</code> vistos en clase. Recordad que podemos obtener más información sobre las variables con <code>?mtcars</code>. También podemos usar <code>glimpse()</code> para ver qué tipo de variables tenemos, y en caso de ser variables categóricas, qué categorías hay (Siempre es muy recomendable hacer este tipo de visualización de datos para ver que no hayan valores raros ni categorías no definidas o errores en la definición de categorías - por ejemplo tener la variable sexo como: H, M, h, m, hombre).</p>
<ul>
<li><p>Visualiza la variable ‘hp’ usando la función <code>select()</code>. Intenta usar la función <code>pull()</code> para hacer lo mismo y ver cuál es la diferencia.</p></li>
<li><p>Visualiza todos los datos excepto la columna ‘hp’.</p></li>
<li><p>Visualiza las columnas mpg, hp, vs, am y gear escribiendo el código más corto posible.</p></li>
<li><p>Crea un objeto que se llame ‘mycars’ que contenga las columnas mpg y hp pero que el nombre de la variable sea ‘miles_per_gallon’ y ‘horse_power’ respectivamente. Pon los rownames del data.frame en una variable que se llame ‘model’ [PISTA: debes buscar qué función hay para poner los rownames en una columna].</p></li>
<li><p>Crea una nueva variable en ‘mycars’ que sea ‘km_per_litre’ que describa el consumo del coche (variable ‘mpg’). NOTA: 1 mpg es 0.425 km / l.</p></li>
<li><p>Selecciona al azar (y visualiza) la mitad de las observaciones de ‘mycars’ [PISTA: busca una función de <code>dplyr</code> que haga esto de forma sencilla (similar a <code>sample</code> en R tradicional).</p></li>
<li><p>Crea un objeto ‘mycars_s’ que contenga de la 10ª a la 35ª fila de mycars [PISTA: considera usar la función <code>slice()</code>].</p></li>
<li><p>Visualiza el objeto ‘mycars_s’ sin duplicados [PISTA_ encia: considera usar la función <code>distinct()</code>].</p></li>
<li><p>Visualiza del objeto ‘mycars_s’ todas las observaciones que tengan mpg&gt; 20 y hp&gt; 100.</p></li>
<li><p>Visualiza la la fila correspondiente al coche Lotus Europa.</p></li>
</ul>
</div>
<div id="visualización-de-datos" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Visualización de datos</h2>
<p>R es una herramienta muy potente para realizar gráficos, mucho más que otros software de análisis estadístico como SPSS, SAS o Stata. Aún así, <code>ggplot</code> fue desarrollado con los siguientes objetivos:</p>
<p><code>The aim of the grammar is to “bring together in a coherent way things that previously appeared unrelated and which also will provide a basis for dealing systematically with new situations” (Cox 1978). How well have we succeeded? (Wickham, 2012)</code></p>
<p>``The emphasis in ggplot2 is reducing the amount of thinking time by making it easier to go from the plot in your brain to the plot on the page." (Wickham, 2012)```</p>
<p><code>Base graphics are good for drawing pictures; ggplot2 graphics are good for understanding the data." (Wickham, 2012)</code></p>
<p>En definitiva, deberíamos usar <code>ggplot</code> porque:</p>
<ul>
<li>Es flexible</li>
<li>Tenemos gran control de lo que estamos haciendo</li>
<li>Crea gráficos muy bonitos (y se usan en la mayoría de revistas científicas)</li>
<li>De forma más importante, hay mucha documentación sobre cómo hacer gráficos muy complicados de forma sencilla (libros, páginas web, infografrías, etc.</li>
</ul>
<p><a href="https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf">Aquí</a> podéis encontrar una chuleta con las principales funciones</p>
<p>Cada visualización en ggplot se compone de:</p>
<p><strong>plot = data + Aesthetics + geometry</strong></p>
<ul>
<li><strong>Datos</strong> (<em>Data</em>) que queremos representar (que serán un data frame).</li>
<li><strong>Características estéticas</strong> (<em>aesthetic mappings</em>) que describen cómo queremos que los datos se vean en el gráfico. Para más información podemos consultar la vignette (vignette(“ggplot2-specs”)). Como luego veremos, se introducen con la función aes() y se refieren a:
<ul>
<li>posición (en los ejes)</li>
<li>color exterior (color) y de relleno (fill)</li>
<li>forma de puntos (shape)</li>
<li>tipo de línea (linetype)</li>
<li>tamaño (size)</li>
</ul></li>
<li><strong>Objetos geométricos</strong> (<em>Geom</em>) representan lo que vemos en un gráficos (puntos, líneas, etc.). Todo gráfico tiene, como mínimo, una geometría. La geometría determina el tipo de gráfico:
<ul>
<li>geom_point (para puntos)</li>
<li>geom_lines (para lineas)</li>
<li>geom_histogram (para histograma)</li>
<li>geom_boxplot (para boxplot)</li>
<li>geom_bar (para barras)</li>
<li>geom_smooth (líneas suavizadas)</li>
<li>geom_polygons (para polígonos en un mapa)</li>
<li>etc. (si ejecutáis el comando help.search(“geom_”, package = “ggplot2”) podéis ver el listado de objetos geométricos)</li>
</ul></li>
</ul>
<p>Por tanto, para construir un gráfico con ggplot2 comenzamos con la siguiente estructura de código:</p>
<p><strong>ggplot(datos, aes()) + geom_tipo()</strong></p>
<p>Por ejemplo para hacer una gráfica que represente las millas por galón (mpg) en función del peso del coche, podemos hacer los siguiente:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="introducción-a-tidyverse.html#cb64-1"></a>mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>]</span></code></pre></div>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="introducción-a-tidyverse.html#cb66-1"></a><span class="kw">ggplot</span>(mtcars) <span class="op">+</span><span class="st">         </span><span class="co"># data</span></span>
<span id="cb66-2"><a href="introducción-a-tidyverse.html#cb66-2"></a><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> mpg, <span class="dt">y=</span>wt) <span class="op">+</span><span class="st">   </span><span class="co"># Aesthetics</span></span>
<span id="cb66-3"><a href="introducción-a-tidyverse.html#cb66-3"></a><span class="st">  </span><span class="kw">geom_point</span>()           <span class="co"># geometry (layer)  </span></span></code></pre></div>
<p><img src="_main_files/figure-html/plot_mtcars-1.png" width="672" /></p>
<p>Podemos cambiar a una de estas estéticas</p>
<ul>
<li><code>theme_dark()</code></li>
<li><code>theme_minimal()</code></li>
<li><code>theme_classic()</code></li>
<li><code>theme_void()</code></li>
<li><code>theme_test()</code></li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="introducción-a-tidyverse.html#cb67-1"></a><span class="kw">ggplot</span>(mtcars) <span class="op">+</span><span class="st">         </span><span class="co"># data</span></span>
<span id="cb67-2"><a href="introducción-a-tidyverse.html#cb67-2"></a><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> mpg, <span class="dt">y=</span>wt) <span class="op">+</span><span class="st">   </span><span class="co"># Aesthetics</span></span>
<span id="cb67-3"><a href="introducción-a-tidyverse.html#cb67-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st">         </span><span class="co"># geometry (layer)  </span></span>
<span id="cb67-4"><a href="introducción-a-tidyverse.html#cb67-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>()        <span class="co"># theme </span></span></code></pre></div>
<p><img src="_main_files/figure-html/plot_mtcars2-1.png" width="672" /></p>
<p>o alguna geometría</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="introducción-a-tidyverse.html#cb68-1"></a><span class="kw">ggplot</span>(mtcars) <span class="op">+</span><span class="st">        </span></span>
<span id="cb68-2"><a href="introducción-a-tidyverse.html#cb68-2"></a><span class="st">  </span><span class="kw">aes</span>(<span class="dt">sample =</span> mpg) <span class="op">+</span><span class="st"> </span><span class="kw">stat_qq</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/area-1.png" width="672" /></p>
<p>A continuación ilustratemos cómo hacer los principales tipos de gráficos que necesitamos en estadística</p>
<div id="distribución-de-datos-categóricos" class="section level3" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Distribución de datos categóricos</h3>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="introducción-a-tidyverse.html#cb69-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb69-2"><a href="introducción-a-tidyverse.html#cb69-2"></a>diamonds</span></code></pre></div>
<pre><code>## # A tibble: 53,940 x 10
##    carat cut       color clarity depth table price     x     y     z
##    &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 0.23  Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
##  2 0.21  Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
##  3 0.23  Good      E     VS1      56.9    65   327  4.05  4.07  2.31
##  4 0.290 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
##  5 0.31  Good      J     SI2      63.3    58   335  4.34  4.35  2.75
##  6 0.24  Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48
##  7 0.24  Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47
##  8 0.26  Very Good H     SI1      61.9    55   337  4.07  4.11  2.53
##  9 0.22  Fair      E     VS2      65.1    61   337  3.87  3.78  2.49
## 10 0.23  Very Good H     VS1      59.4    61   338  4     4.05  2.39
## # ... with 53,930 more rows</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="introducción-a-tidyverse.html#cb71-1"></a><span class="kw">count</span>(diamonds, cut)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   cut           n
##   &lt;ord&gt;     &lt;int&gt;
## 1 Fair       1610
## 2 Good       4906
## 3 Very Good 12082
## 4 Premium   13791
## 5 Ideal     21551</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="introducción-a-tidyverse.html#cb73-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds)</span></code></pre></div>
<p><img src="_main_files/figure-html/empty-1.png" width="672" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="introducción-a-tidyverse.html#cb74-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span></span>
<span id="cb74-2"><a href="introducción-a-tidyverse.html#cb74-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut))</span></code></pre></div>
<p><img src="_main_files/figure-html/dist_cat-1.png" width="672" /></p>
</div>
<div id="distribución-de-datos-continuos" class="section level3" number="2.7.2">
<h3><span class="header-section-number">2.7.2</span> Distribución de datos continuos</h3>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="introducción-a-tidyverse.html#cb75-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span></span>
<span id="cb75-2"><a href="introducción-a-tidyverse.html#cb75-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> carat), <span class="dt">binwidth =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/dist_cont-1.png" width="672" /></p>
</div>
<div id="distribución-de-datos-continuos-según-una-variable-categórica" class="section level3" number="2.7.3">
<h3><span class="header-section-number">2.7.3</span> Distribución de datos continuos según una variable categórica</h3>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="introducción-a-tidyverse.html#cb76-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> price)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb76-2"><a href="introducción-a-tidyverse.html#cb76-2"></a><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">colour =</span> cut), <span class="dt">binwidth =</span> <span class="dv">500</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/dist_2-1.png" width="672" /></p>
<p>Idealmente esta descriptiva debemos hacerla con un boxplot</p>
<div class="figure">
<img src="fig/EDA-boxplot.png" alt="" />
<p class="caption">Box-plot</p>
</div>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="introducción-a-tidyverse.html#cb77-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> class, <span class="dt">y =</span> hwy)) <span class="op">+</span></span>
<span id="cb77-2"><a href="introducción-a-tidyverse.html#cb77-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/boxplot-1.png" width="672" /></p>
<p>Podemos reordenar el boxplot para facilitar la interpretación de la siguiente manera (notamos que el código es mucho más compacto y legible que en R tradicional)</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="introducción-a-tidyverse.html#cb78-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span></span>
<span id="cb78-2"><a href="introducción-a-tidyverse.html#cb78-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, </span>
<span id="cb78-3"><a href="introducción-a-tidyverse.html#cb78-3"></a>                                         <span class="dt">FUN =</span> median), </span>
<span id="cb78-4"><a href="introducción-a-tidyverse.html#cb78-4"></a>                             <span class="dt">y =</span> hwy))</span></code></pre></div>
<p><img src="_main_files/figure-html/boxplot2-1.png" width="672" /></p>
<p>Podemos cambiar las coordenadas añadiendo otra función</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="introducción-a-tidyverse.html#cb79-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span></span>
<span id="cb79-2"><a href="introducción-a-tidyverse.html#cb79-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, </span>
<span id="cb79-3"><a href="introducción-a-tidyverse.html#cb79-3"></a>                                         <span class="dt">FUN =</span> median), </span>
<span id="cb79-4"><a href="introducción-a-tidyverse.html#cb79-4"></a>                             <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/boxplot_flipped-1.png" width="672" /></p>
<p>Los gráficos se pueden reciclar y aprovechar el código ya escrito</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="introducción-a-tidyverse.html#cb80-1"></a>plt &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span></span>
<span id="cb80-2"><a href="introducción-a-tidyverse.html#cb80-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, </span>
<span id="cb80-3"><a href="introducción-a-tidyverse.html#cb80-3"></a>                                         <span class="dt">FUN =</span> median), </span>
<span id="cb80-4"><a href="introducción-a-tidyverse.html#cb80-4"></a>                             <span class="dt">y =</span> hwy))</span>
<span id="cb80-5"><a href="introducción-a-tidyverse.html#cb80-5"></a></span>
<span id="cb80-6"><a href="introducción-a-tidyverse.html#cb80-6"></a>plt <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p>Podemos mejorar un boxplot añadiendo más información tras ’ + ’</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="introducción-a-tidyverse.html#cb81-1"></a><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Species, <span class="dt">y=</span>Sepal.Width) ) <span class="op">+</span></span>
<span id="cb81-2"><a href="introducción-a-tidyverse.html#cb81-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>, <span class="dt">outlier.colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb81-3"><a href="introducción-a-tidyverse.html#cb81-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">stat=</span> <span class="st">&quot;summary&quot;</span>, <span class="dt">fun.y=</span>mean, </span>
<span id="cb81-4"><a href="introducción-a-tidyverse.html#cb81-4"></a>             <span class="dt">shape=</span><span class="dv">16</span>, <span class="dt">size=</span><span class="fl">1.5</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb81-5"><a href="introducción-a-tidyverse.html#cb81-5"></a><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/improved_boxplot-1.png" width="672" /></p>
</div>
<div id="dos-variables-categóricas" class="section level3" number="2.7.4">
<h3><span class="header-section-number">2.7.4</span> Dos variables categóricas</h3>
<p>Podemos resumir dos variables categóricas de esta forma</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="introducción-a-tidyverse.html#cb82-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span></span>
<span id="cb82-2"><a href="introducción-a-tidyverse.html#cb82-2"></a><span class="st">  </span><span class="kw">geom_count</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> color))</span></code></pre></div>
<p><img src="_main_files/figure-html/two_cat-1.png" width="432" /></p>
<p>Otra aproximación sería contar cuántos hay en una categoría con <code>dplyr</code>:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="introducción-a-tidyverse.html#cb83-1"></a>diamonds <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-2"><a href="introducción-a-tidyverse.html#cb83-2"></a><span class="st">  </span><span class="kw">count</span>(color, cut)</span></code></pre></div>
<pre><code>## # A tibble: 35 x 3
##    color cut           n
##    &lt;ord&gt; &lt;ord&gt;     &lt;int&gt;
##  1 D     Fair        163
##  2 D     Good        662
##  3 D     Very Good  1513
##  4 D     Premium    1603
##  5 D     Ideal      2834
##  6 E     Fair        224
##  7 E     Good        933
##  8 E     Very Good  2400
##  9 E     Premium    2337
## 10 E     Ideal      3903
## # ... with 25 more rows</code></pre>
<p>y luego visualizarlo con <code>geom_tile()</code> que nos daría un gráfico tipo heatmap</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="introducción-a-tidyverse.html#cb85-1"></a>diamonds <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb85-2"><a href="introducción-a-tidyverse.html#cb85-2"></a><span class="st">  </span><span class="kw">count</span>(color, cut) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb85-3"><a href="introducción-a-tidyverse.html#cb85-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> cut)) <span class="op">+</span></span>
<span id="cb85-4"><a href="introducción-a-tidyverse.html#cb85-4"></a><span class="st">    </span><span class="kw">geom_tile</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> n))</span></code></pre></div>
<p><img src="_main_files/figure-html/visualize-1.png" width="384" /></p>
</div>
<div id="dos-variables-continuas" class="section level3" number="2.7.5">
<h3><span class="header-section-number">2.7.5</span> Dos variables continuas</h3>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="introducción-a-tidyverse.html#cb86-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span></span>
<span id="cb86-2"><a href="introducción-a-tidyverse.html#cb86-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price))</span></code></pre></div>
<p><img src="_main_files/figure-html/2cont%20-1.png" width="336" /></p>
<p>Scatterplots se vuelven menos útiles cuando el tamaño del conjunto de datos aumenta porque los puntos coinciden. En ese caso podemos usar la estética <code>alpha</code>:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="introducción-a-tidyverse.html#cb87-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span></span>
<span id="cb87-2"><a href="introducción-a-tidyverse.html#cb87-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price), </span>
<span id="cb87-3"><a href="introducción-a-tidyverse.html#cb87-3"></a>             <span class="dt">alpha =</span> <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_alpha-1.png" width="672" /></p>
<p>Otra opción es discretizar una de las variables continuas y usar <code>boxplot()</code></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="introducción-a-tidyverse.html#cb88-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb88-2"><a href="introducción-a-tidyverse.html#cb88-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">cut_width</span>(carat, <span class="fl">0.1</span>)))</span></code></pre></div>
<p><img src="_main_files/figure-html/bin_2cont-1.png" width="672" /></p>
<p>A veces nos interesa añadir una línea de regresión al gráfico. Exsiten numerosas librerías que extienden las facilidades de <code>ggplot</code> com esta:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="introducción-a-tidyverse.html#cb89-1"></a><span class="kw">library</span>(ggpmisc)</span>
<span id="cb89-2"><a href="introducción-a-tidyverse.html#cb89-2"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb89-3"><a href="introducción-a-tidyverse.html#cb89-3"></a>iris &lt;-<span class="st"> </span><span class="kw">mutate</span>(iris,</span>
<span id="cb89-4"><a href="introducción-a-tidyverse.html#cb89-4"></a>               <span class="dt">Y =</span> <span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="fl">3.2</span><span class="op">*</span>Sepal.Width <span class="op">+</span></span>
<span id="cb89-5"><a href="introducción-a-tidyverse.html#cb89-5"></a><span class="st">                 </span><span class="kw">rnorm</span>(<span class="kw">nrow</span>(iris)))</span>
<span id="cb89-6"><a href="introducción-a-tidyverse.html#cb89-6"></a><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Width, <span class="dt">y =</span> Y)) <span class="op">+</span></span>
<span id="cb89-7"><a href="introducción-a-tidyverse.html#cb89-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">color=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb89-8"><a href="introducción-a-tidyverse.html#cb89-8"></a>              <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x) <span class="op">+</span></span>
<span id="cb89-9"><a href="introducción-a-tidyverse.html#cb89-9"></a><span class="st">  </span><span class="kw">stat_poly_eq</span>(<span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x,</span>
<span id="cb89-10"><a href="introducción-a-tidyverse.html#cb89-10"></a>               <span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">paste</span>(..eq.label.., ..rr.label.., </span>
<span id="cb89-11"><a href="introducción-a-tidyverse.html#cb89-11"></a>                                 <span class="dt">sep =</span> <span class="st">&quot;~~~&quot;</span>)),</span>
<span id="cb89-12"><a href="introducción-a-tidyverse.html#cb89-12"></a>               <span class="dt">parse =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb89-13"><a href="introducción-a-tidyverse.html#cb89-13"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/lm_info-1.png" width="672" /></p>
<p>R tiene unas capacidades gráficas excelentes, pero el uso de <code>ggplot</code> hace que éstas sean aún más espectaculares. Imaginemos que queremos comparar la expresión génica según la tasa de crecimiento en 20 genes y seis condiciones<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="introducción-a-tidyverse.html#cb90-1"></a><span class="kw">load</span>(<span class="st">&quot;data/genes.Rdata&quot;</span>)</span>
<span id="cb90-2"><a href="introducción-a-tidyverse.html#cb90-2"></a>genes</span></code></pre></div>
<pre><code>## # A tibble: 711 x 7
##    name    BP                              MF                                         systematic_name nutrient  rate expression
##    &lt;chr&gt;   &lt;chr&gt;                           &lt;chr&gt;                                      &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt;
##  1 &quot;SUL1&quot;  sulfate transport               sulfate transporter activity               YBR294W         Glucose   0.05     -0.32 
##  2 &quot;&quot;      biological process unknown      molecular function unknown                 YKL187C         Glucose   0.05      4.13 
##  3 &quot;QDR2&quot;  multidrug transport             multidrug efflux pump activity             YIL121W         Glucose   0.05      1.07 
##  4 &quot;LEU1&quot;  leucine biosynthesis            3-isopropylmalate dehydratase activity     YGL009C         Glucose   0.05     -1.12 
##  5 &quot;PHO5&quot;  phosphate metabolism*           acid phosphatase activity                  YBR093C         Glucose   0.05      2.39 
##  6 &quot;PHO12&quot; biological process unknown      acid phosphatase activity                  YHR215W         Glucose   0.05      0.9  
##  7 &quot;PHO11&quot; phosphate metabolism            acid phosphatase activity                  YAR071W         Glucose   0.05      1.14 
##  8 &quot;GIT1&quot;  glycerophosphodiester transport glycerophosphodiester transporter activity YCR098C         Glucose   0.05      0.77 
##  9 &quot;AGP3&quot;  amino acid transport            amino acid transporter activity            YFL055W         Glucose   0.05      0.570
## 10 &quot;&quot;      biological process unknown      molecular function unknown                 YOL164W         Glucose   0.05      0.53 
## # ... with 701 more rows</code></pre>
<p>Este tendría que ser el (largo) código para hacer este gráfico usando funciones básicas de R (el aspecto del gráfico es mejorable y la sintaxis de R ilegible)</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="introducción-a-tidyverse.html#cb92-1"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>))</span>
<span id="cb92-2"><a href="introducción-a-tidyverse.html#cb92-2"></a></span>
<span id="cb92-3"><a href="introducción-a-tidyverse.html#cb92-3"></a>colors &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">6</span></span>
<span id="cb92-4"><a href="introducción-a-tidyverse.html#cb92-4"></a><span class="kw">names</span>(colors) &lt;-<span class="st"> </span><span class="kw">unique</span>(genes<span class="op">$</span>nutrient)</span>
<span id="cb92-5"><a href="introducción-a-tidyverse.html#cb92-5"></a></span>
<span id="cb92-6"><a href="introducción-a-tidyverse.html#cb92-6"></a>m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">21</span>, <span class="dv">21</span>, <span class="dv">21</span>), <span class="dt">nrow =</span> <span class="dv">6</span>, </span>
<span id="cb92-7"><a href="introducción-a-tidyverse.html#cb92-7"></a>            <span class="dt">ncol =</span> <span class="dv">4</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span>
<span id="cb92-8"><a href="introducción-a-tidyverse.html#cb92-8"></a><span class="kw">layout</span>(<span class="dt">mat =</span> m, <span class="dt">heights =</span> <span class="kw">c</span>(.<span class="dv">18</span>, <span class="fl">.18</span>, <span class="fl">.18</span>, <span class="fl">.18</span>, <span class="fl">.18</span>, <span class="fl">.1</span>))</span>
<span id="cb92-9"><a href="introducción-a-tidyverse.html#cb92-9"></a></span>
<span id="cb92-10"><a href="introducción-a-tidyverse.html#cb92-10"></a>genes<span class="op">$</span>combined &lt;-<span class="st"> </span><span class="kw">paste</span>(genes<span class="op">$</span>name, genes<span class="op">$</span>systematic_name)</span>
<span id="cb92-11"><a href="introducción-a-tidyverse.html#cb92-11"></a><span class="cf">for</span> (gene <span class="cf">in</span> <span class="kw">unique</span>(genes<span class="op">$</span>combined)) {</span>
<span id="cb92-12"><a href="introducción-a-tidyverse.html#cb92-12"></a>    sub_data &lt;-<span class="st"> </span><span class="kw">filter</span>(genes, combined <span class="op">==</span><span class="st"> </span>gene)</span>
<span id="cb92-13"><a href="introducción-a-tidyverse.html#cb92-13"></a>    <span class="kw">plot</span>(expression <span class="op">~</span><span class="st"> </span>rate, sub_data, </span>
<span id="cb92-14"><a href="introducción-a-tidyverse.html#cb92-14"></a>         <span class="dt">col =</span> colors[sub_data<span class="op">$</span>nutrient], <span class="dt">main =</span> gene)</span>
<span id="cb92-15"><a href="introducción-a-tidyverse.html#cb92-15"></a>    <span class="cf">for</span> (n <span class="cf">in</span> <span class="kw">unique</span>(sub_data<span class="op">$</span>nutrient)) {</span>
<span id="cb92-16"><a href="introducción-a-tidyverse.html#cb92-16"></a>        m &lt;-<span class="st"> </span><span class="kw">lm</span>(expression <span class="op">~</span><span class="st"> </span>rate, </span>
<span id="cb92-17"><a href="introducción-a-tidyverse.html#cb92-17"></a>                <span class="kw">filter</span>(sub_data, nutrient <span class="op">==</span><span class="st"> </span>n))</span>
<span id="cb92-18"><a href="introducción-a-tidyverse.html#cb92-18"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.na</span>(m<span class="op">$</span>coefficients[<span class="dv">2</span>])) {</span>
<span id="cb92-19"><a href="introducción-a-tidyverse.html#cb92-19"></a>            <span class="kw">abline</span>(m, <span class="dt">col =</span> colors[n])</span>
<span id="cb92-20"><a href="introducción-a-tidyverse.html#cb92-20"></a>        }</span>
<span id="cb92-21"><a href="introducción-a-tidyverse.html#cb92-21"></a>    }</span>
<span id="cb92-22"><a href="introducción-a-tidyverse.html#cb92-22"></a>}</span>
<span id="cb92-23"><a href="introducción-a-tidyverse.html#cb92-23"></a></span>
<span id="cb92-24"><a href="introducción-a-tidyverse.html#cb92-24"></a><span class="co"># create a new plot for legend</span></span>
<span id="cb92-25"><a href="introducción-a-tidyverse.html#cb92-25"></a><span class="kw">plot</span>(<span class="dv">1</span>, <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb92-26"><a href="introducción-a-tidyverse.html#cb92-26"></a><span class="kw">legend</span>(<span class="st">&quot;top&quot;</span>, <span class="kw">names</span>(colors), <span class="dt">col =</span> colors, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">lwd =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_with_r-1.png" width="672" /></p>
<p>Sin embargo con <code>ggplot2</code> bastaría con</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="introducción-a-tidyverse.html#cb93-1"></a><span class="kw">ggplot</span>(genes, <span class="kw">aes</span>(rate, expression, <span class="dt">color =</span> nutrient)) <span class="op">+</span></span>
<span id="cb93-2"><a href="introducción-a-tidyverse.html#cb93-2"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb93-3"><a href="introducción-a-tidyverse.html#cb93-3"></a><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb93-4"><a href="introducción-a-tidyverse.html#cb93-4"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name <span class="op">+</span><span class="st"> </span>systematic_name, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_genes-1.png" width="672" /></p>
</div>
<div id="facets" class="section level3" number="2.7.6">
<h3><span class="header-section-number">2.7.6</span> Facets</h3>
<p><em>Faceting</em> es el proceso que en el dividimos la ventana del gráfico en varias partes pequeñas (una cuadrícula) y muestra un gráfico similar en cada sección. Cada sección generalmente muestra el mismo gráfico para un grupo específico del conjunto de datos. Aquí podemos ver cómo llevar a cabo este tipo de gráficos. Utilizaremos una base de datos sobre propinas</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="introducción-a-tidyverse.html#cb94-1"></a><span class="kw">data</span>(tips, <span class="dt">package=</span><span class="st">&quot;reshape2&quot;</span>)</span>
<span id="cb94-2"><a href="introducción-a-tidyverse.html#cb94-2"></a><span class="kw">head</span>(tips)</span></code></pre></div>
<pre><code>##   total_bill  tip    sex smoker day   time size
## 1      16.99 1.01 Female     No Sun Dinner    2
## 2      10.34 1.66   Male     No Sun Dinner    3
## 3      21.01 3.50   Male     No Sun Dinner    3
## 4      23.68 3.31   Male     No Sun Dinner    2
## 5      24.59 3.61 Female     No Sun Dinner    4
## 6      25.29 4.71   Male     No Sun Dinner    4</code></pre>
<p>Imaginemos que queremos representar qué propinas se dan en función del total de la cuenta</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="introducción-a-tidyverse.html#cb96-1"></a>sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tips, <span class="kw">aes</span>(<span class="dt">x=</span>total_bill, <span class="dt">y=</span>tip<span class="op">/</span>total_bill)) <span class="op">+</span></span>
<span id="cb96-2"><a href="introducción-a-tidyverse.html#cb96-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb96-3"><a href="introducción-a-tidyverse.html#cb96-3"></a>sp</span></code></pre></div>
<p><img src="_main_files/figure-html/facet-1.png" width="672" /></p>
<p>Ahora nos puede interesar obtener el mismo gráfico para hombres y mujeres. Para ello, podemos hacer el <em>faceting</em> de forma vertical</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="introducción-a-tidyverse.html#cb97-1"></a><span class="co"># vertical direction</span></span>
<span id="cb97-2"><a href="introducción-a-tidyverse.html#cb97-2"></a>sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>.)</span></code></pre></div>
<p><img src="_main_files/figure-html/grid_vertical-1.png" width="672" /></p>
<p>u horizontal</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="introducción-a-tidyverse.html#cb98-1"></a><span class="co"># horizontal direction</span></span>
<span id="cb98-2"><a href="introducción-a-tidyverse.html#cb98-2"></a>sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>sex)</span></code></pre></div>
<p><img src="_main_files/figure-html/grid_horiz-1.png" width="672" /></p>
<p>también según dos variables</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="introducción-a-tidyverse.html#cb99-1"></a><span class="co"># Divide with &quot;sex&quot; vertical, &quot;day&quot; horizontal</span></span>
<span id="cb99-2"><a href="introducción-a-tidyverse.html#cb99-2"></a>sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>day)</span></code></pre></div>
<p><img src="_main_files/figure-html/grid_two-1.png" width="672" /></p>
<p>En lugar de crear los paneles con una variable en la dirección horizontal o vertical, las gráficas se pueden colocar una al lado de la otra, envolviéndose con un cierto número de columnas o filas. La etiqueta de cada figura estará en la parte superior.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="introducción-a-tidyverse.html#cb100-1"></a><span class="co"># Divide by day, going horizontally and wrapping with 2 columns</span></span>
<span id="cb100-2"><a href="introducción-a-tidyverse.html#cb100-2"></a>sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>day, <span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/wrap-1.png" width="672" /></p>
<p>Podemos cambiar todo lo que queramos. Este es sólo un ejemplo</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="introducción-a-tidyverse.html#cb101-1"></a>sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>day) <span class="op">+</span></span>
<span id="cb101-2"><a href="introducción-a-tidyverse.html#cb101-2"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">8</span>, <span class="dt">angle=</span><span class="dv">75</span>),</span>
<span id="cb101-3"><a href="introducción-a-tidyverse.html#cb101-3"></a>          <span class="dt">strip.text.y =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">12</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb101-4"><a href="introducción-a-tidyverse.html#cb101-4"></a>          <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">colour=</span><span class="st">&quot;brown&quot;</span>,</span>
<span id="cb101-5"><a href="introducción-a-tidyverse.html#cb101-5"></a>                                          <span class="dt">fill=</span><span class="st">&quot;tomato&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/modifying-1.png" width="672" /></p>
<p>En este <a href="https://ggplot2.tidyverse.org/reference/">link</a> tenéis la referencia de ggplot2.</p>
</div>
</div>
<div id="ejercicios-visualización-de-datos" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Ejercicios (Visualización de datos)</h2>
<ol style="list-style-type: decimal">
<li><p>Visualiza el número de vuelos para cada aerolínia por mes.</p></li>
<li><p>Visualiza la distribución de la variabla carat según el precio en el dataset <code>diamonds</code>.</p></li>
<li><p>Carga los datos qe están en <a href="https://raw.githubusercontent.com/isglobal-brge/TeachingMaterials/master/Master_Modelling/data/genome.txt" class="uri">https://raw.githubusercontent.com/isglobal-brge/TeachingMaterials/master/Master_Modelling/data/genome.txt</a> en tu sesión de RStudio utilizando la función <code>read_delim</code> (NOTA: los datos están delimitados por tabulaciones - no hace falta bajarlos al ordenador se cargan desde la URL).</p></li>
</ol>
<p>El archivo contiene información sobre ~730K variantes genéticas en todo el genoma:</p>
<ul>
<li><p>Name: variante genómica (single nucleotide polymorphism)</p></li>
<li><p>Chr: cromosoma</p></li>
<li><p>Position: posición en el cromosoma</p></li>
<li><p>Log.R.Ratio: log-ratio de la intensidad de los dos alelos</p></li>
<li><p>B.Allele.Freq: frecuencia del alelo alternativo</p>
<ul>
<li>¿Cuál es el valor esperado (media) de <code>Log.R.Ratio</code> y <code>B.Allel.Freq</code> para cada cromosoma? (muestra el código de R que usas para obtener dicha información)</li>
<li>Crea un “facet plot” que represente el <code>Log.R.Ratio</code> para cada cromosoma</li>
<li>Crea un “facet plot” que represente el <code>B.Allele.Freq</code> para los cromosomas 1, 2, 3, …, 6 y pinta la etiqueta <code>B.Allele.Freq</code> en rojo.</li>
</ul></li>
</ul>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>ejemplo obtenido de <a href="http://varianceexplained.org/r/why-I-use-ggplot2/" class="uri">http://varianceexplained.org/r/why-I-use-ggplot2/</a>)<a href="introducción-a-tidyverse.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="regresión-lineal.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-tidyverse.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
